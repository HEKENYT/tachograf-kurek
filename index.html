<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rezerwacja Tachograf</title>
<style>
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background: #1e1e1e; color: #f0f0f0; }
.header { 
  background: #222;
   color: #fff;
   padding: 20px;
   border-radius: 10px;
   margin-bottom: 25px;
   text-align: center;
   box-shadow: 0 5px 15px rgba(0,0,0,0.4);
   font-weight: bold;
  }
.container {
  max-width: 750px;
  margin: auto;
  background: #2e2e2e;
  padding: 25px;
  border-radius: 15px;
  box-shadow: 0 5px 20px rgba(0,0,0,0.5);
}
select, input { width: 100%;
               padding: 14px;
               margin: 12px 0;
               border-radius: 8px;
               border: 1px solid #777;
               background: #3c3c3c;
               color: #f9f9f9; 
              }
select:focus, input:focus { 
  outline: none;
  border-color: #00d4ff;
  box-shadow: 0 0 10px #00d4ff;
}
.opcje { margin-top: 25px; }
.opcja { background: #3b3b3b;
        padding: 20px;
        margin-bottom: 15px;
        border-radius: 12px;
        transition: transform 0.3s ease, background 0.3s, box-shadow 0.3s;
        cursor: pointer; border-left: 4px solid #00d4ff;
       }
.opcja:hover { 
  transform: translateX(5px);
  background: #4a4a4a; box-shadow: 0 5px 15px rgba(0,0,0,0.6);
}
button { 
  padding: 14px 30px;
  background: #00aaff;
  color: #fff; border: none;
  border-radius: 10px;
  cursor: pointer;
  width: 100%;
  font-weight: bold;
  letter-spacing: 0.5px; 
  transition: transform 0.2s ease, background 0.3s, box-shadow 0.3s; 
}
button:hover {
  transform: scale(1.05);
  background: #00d4ff;
  box-shadow: 0 6px 18px rgba(0,0,0,0.7);
}
#formularz { 
  display: none; 
  margin-top: 25px; 
  background: #3a3a3a;
  padding: 30px;
  border-radius: 15px;
  opacity: 0;
  transform: translateY(25px);
  transition: all 0.5s ease;
  border-left: 4px solid #00d4ff;
}
.potwierdzenie {
  margin-top: 25px; 
  font-weight: bold; 
  color: #00ffcc; }
footer {
  background-color: #222;
  margin-top: 40px; 
  margin-left: -18px; 
  width: 160px;
  text-align: center; 
  font-size: 10px; 
  border-radius: 15px;
  float: left; }

.popup {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.7);
  backdrop-filter: blur(3px);
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.popup-content {
  background: #2e2e2e;
  padding: 30px;
  border-radius: 15px;
  text-align: center;
  width: 90%;
  max-width: 400px;
  border-left: 4px solid #00d4ff;
  box-shadow: 0 5px 20px rgba(0,0,0,0.5);
  animation: popupFade 0.4s ease;
}

.popup-content h2 {
  margin-top: 0;
  color: #00d4ff;
}

.popup-content button {
  margin-top: 20px;
  padding: 12px 25px;
  background: #00aaff;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  color: #fff;
  font-weight: bold;
}

.popup-content button:hover {
  background: #00d4ff;
}

@keyframes popupFade {
  from { opacity: 0; transform: translateY(-20px); }
  to   { opacity: 1; transform: translateY(0); }
}

</style>
</head>
<body>
<header class="header">
<h1>Szkolenia z obsługi tachografów cyfrowych wszystkich generacji oraz czasu pracy kierowców</h1>
<h3>Trener kwalifikowany certyfikatem kompetencji Dagmara Kurek</h3>
<p>Kontakt: +48 788 874 147 | Email: szkoleniaztacho@gmail.com</p>
</header>

<div class="container">
<h2>Rezerwacja Terminu Szkolenia – Wybierz Miesiąc i Lokalizację</h2>

<label>Wybierz miesiąc:</label>
<select id="miesiac"></select>

<label>Wybierz miasto:</label>
<select id="miasto">
<option value="Oświęcim">Oświęcim</option>
<option value="Katowice">Katowice</option>
<option value="Kraków">Kraków</option>
</select>

<div class="opcje" id="opcje"></div>

<div id="formularz">
<h3>Podaj swoje dane</h3>
<input type="text" id="imie" placeholder="Imię">
<input type="text" id="nazwisko" placeholder="Nazwisko">
<input type="email" id="email" placeholder="Email">
<input type="tel" id="telefon" placeholder="Numer telefonu">
<button onclick="wyslijDane()">Wyślij</button>
</div>

<p id="potwierdzenie" class="potwierdzenie"></p>


</div>

<script>
let wybraneMiasto = "";
let wybranaData = "";

const opcjeDiv = document.getElementById("opcje");
const miesiacSelect = document.getElementById("miesiac");

function generujNajblizszeMiesiace() {
  miesiacSelect.innerHTML = ""; 

  const dzis = new Date();
  const aktualnyRok = dzis.getFullYear();
  const aktualnyMiesiac = dzis.getMonth();

  for (let i = 0; i < 3; i++) {
    const data = new Date(aktualnyRok, aktualnyMiesiac + i, 1);

    const miesiac = data.toLocaleString('pl-PL', { month: 'long' });
    const option = document.createElement("option");
    option.value = `${data.getFullYear()}-${data.getMonth() + 1}`;
    option.textContent =
      miesiac.charAt(0).toUpperCase() + miesiac.slice(1) + " " + data.getFullYear();

    miesiacSelect.appendChild(option);
  }
}

function generujDaty(miesiac) {
  const [rok, m] = miesiac.split('-').map(Number);
  const daty = [];
  const dzis = new Date();

  let d = new Date(rok, m - 1, 1);

  while (d.getDay() !== 6) {
    d.setDate(d.getDate() + 1);
  }

  while (d.getMonth() === m - 1) {
    if (d >= dzis) {
      const dzien = String(d.getDate()).padStart(2, '0');
      const miesiacL = String(d.getMonth() + 1).padStart(2, '0');
      const rokL = d.getFullYear();
      daty.push(`${rokL}-${miesiacL}-${dzien}`);
    }
    d.setDate(d.getDate() + 7);
  }

  return daty;
}

function pobierzOpcje() {
  const miasto = document.getElementById("miasto").value;
  const miesiac = miesiacSelect.value;
  opcjeDiv.innerHTML = "";

  const daty = generujDaty(miesiac);

  if (daty.length === 0) {
    opcjeDiv.innerHTML = "<p>Brak dostępnych terminów w tym miesiącu.</p>";
    return;
  }

  const najblizsza = daty[0];

  daty.forEach((data, index) => {
    const div = document.createElement("div");
    div.className = "opcja";

    if (data === najblizsza) {
      div.style.border = "2px solid #00ffcc";
      div.style.background = "#404040";
      div.style.transform = "scale(1.02)";
    }

    div.innerHTML = `
    <strong>Spotkanie ${index+1}</strong><br>
    Data: ${data}<br><br>
    <button class="btn-zapis" data-miasto="${miasto}" data-data="${data}">
        Zapisz się
    </button>
    <hr>
`;

    opcjeDiv.appendChild(div);
  });
  
async function pobierzOpcje() {
  const miasto = document.getElementById("miasto").value;
  const miesiac = miesiacSelect.value;
  opcjeDiv.innerHTML = "";

  try {
    const res = await fetch(`/api/available-dates?miasto=${miasto}&miesiac=${miesiac}`);
    const out = await res.json();
    const daty = out.daty;

    if (daty.length === 0) {
      opcjeDiv.innerHTML = "<p>Brak dostępnych terminów w tym miesiącu.</p>";
      return;
    }

    const najblizsza = daty[0];

    daty.forEach((data, index) => {
      const div = document.createElement("div");
      div.className = "opcja";
      if (data === najblizsza) {
        div.style.border = "2px solid #00ffcc";
        div.style.background = "#404040";
        div.style.transform = "scale(1.02)";
      }
      div.innerHTML = `
        <strong>Spotkanie ${index+1}</strong><br>
        Data: ${data}<br><br>
        <button class="btn-zapis" data-miasto="${miasto}" data-data="${data}">
            Zapisz się
        </button>
        <hr>
      `;
      opcjeDiv.appendChild(div);
    });

    document.querySelectorAll(".btn-zapis").forEach(btn => {
      btn.addEventListener("click", async () => {
        const miasto = btn.getAttribute("data-miasto");
        const data = btn.getAttribute("data-data");
        otworzFormularz(miasto, data);
      });
    });

  } catch (err) {
    console.error(err);
    opcjeDiv.innerHTML = "<p>Błąd pobierania terminów.</p>";
  }
}
  document.querySelectorAll(".btn-zapis").forEach(btn => {
    btn.addEventListener("click", () => {
        const miasto = btn.getAttribute("data-miasto");
        const data = btn.getAttribute("data-data");
        otworzFormularz(miasto, data);
    });
});
  
}


async function wyslijDane() {
  const imie = document.getElementById("imie").value.trim();
  const nazwisko = document.getElementById("nazwisko").value.trim();
  const email = document.getElementById("email").value.trim();
  const telefon = document.getElementById("telefon").value.trim();

  if (!imie || !nazwisko || !email || !telefon) { 
    alert("Wypełnij wszystkie pola!");
    return;
  }

  const telRegex = /^[0-9]{9}$/;
  if (!telRegex.test(telefon)) {
    alert("Numer telefonu musi zawierać dokładnie 9 cyfr.");
    return;
  }

  const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
  if (!emailRegex.test(email)) {
    alert("Wprowadź poprawny adres email!");
    return;
  }

  try {
    const res = await fetch("/api/save", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        imie,
        nazwisko,
        email,
        telefon,
        miasto: wybraneMiasto,
        data: wybranaData
      })
    });

    const out = await res.json();
    if (!out.success) { 
      alert("Błąd: " + out.error); 
      return; 
    }

    const f = document.getElementById("formularz");
    f.style.opacity = "0"; 
    f.style.transform = "translateY(25px)";
    setTimeout(() => { f.style.display = "none"; }, 300);

    pokazPopup();

  } catch (err) { 
    console.error("Fetch error:", err); 
    alert("Błąd połączenia z serwerem."); 
  }
}

function pokazPopup() {
  document.getElementById("popup").style.display = "flex";
}

function zamknijPopup() {
  document.getElementById("popup").style.display = "none";
}

function otworzFormularz(miasto, data) {
  wybraneMiasto = miasto;
  wybranaData = data;

  const f = document.getElementById("formularz");

  f.style.display = "block";
  setTimeout(() => {
    f.style.opacity = "1";
    f.style.transform = "translateY(0)";
  }, 10);

  f.scrollIntoView({ behavior: "smooth", block: "start" });

  document.getElementById("potwierdzenie").innerText = "";
}
  
miesiacSelect.addEventListener('change', pobierzOpcje);
document.getElementById("miasto").addEventListener('change', pobierzOpcje);
generujNajblizszeMiesiace();
pobierzOpcje();
</script>
<div id="popup" class="popup">
  <div class="popup-content">
    <h2>Dziękujemy za wysłanie formularza</h2>
    <p>Odezwiemy się do Ciebie w ciągu około 48 godzin.</p>
    <button onclick="zamknijPopup()">Zamknij</button>
  </div>
</div>
</body>
</html>


















